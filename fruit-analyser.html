<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#059669">
    <meta name="description" content="AI-powered fruit ripeness and sweetness detection">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SweetSpot">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlJpcGVseSAtIEZydWl0IFJpcGVuZXNzIENoZWNrZXIiLAogICJzaG9ydF9uYW1lIjogIlJpcGVseSIsCiAgImRlc2NyaXB0aW9uIjogIkFJLXBvd2VyZWQgZnJ1aXQgcmlwZW5lc3MgYW5kIHN3ZWV0bmVzcyBkZXRlY3Rpb24iLAogICJzdGFydF91cmwiOiAiLi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmZmZmZmYiLAogICJ0aGVtZV9jb2xvciI6ICIjMDU5NjY5IiwKICAib3JpZW50YXRpb24iOiAicG9ydHJhaXQiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEwMCAxMDAnJTNFJTNDcmVjdCB3aWR0aD0nMTAwJyBoZWlnaHQ9JzEwMCcgZmlsbD0nJTIzMDU5NjY5Jy8lM0UlM0N0ZXh0IHg9JzUwJTI1JyB5PSc1MCUyNScgZm9udC1zaXplPSc1MCcgdGV4dC1hbmNob3I9J21pZGRsZScgZG9taW5hbnQtYmFzZWxpbmU9J21pZGRsZScgZmlsbD0nd2hpdGUnJTNFJUYwJTlGJThEJTg5JTNDL3RleHQlM0UlM0Mvc3ZnJTNFIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIiwKICAgICAgInB1cnBvc2UiOiAiYW55IG1hc2thYmxlIgogICAgfQogIF0KfQ==">
    <title>SweetSpot - Fruit Ripeness Checker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        
        body {
            margin: 0;
            background: #f8fafc;
            -webkit-font-smoothing: antialiased;
        }
        
        .icon {
            width: 24px;
            height: 24px;
            display: inline-block;
            vertical-align: middle;
        }
        
        video {
            max-width: 100%;
            border-radius: 16px;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }
        
        .shimmer {
            position: relative;
            overflow: hidden;
        }
        
        .shimmer::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            100% { left: 100%; }
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .pulse-button {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .scan-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #10b981, transparent);
            animation: scan 2s linear infinite;
        }
        
        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // Replace with your actual Google Gemini API key
        const GEMINI_API_KEY = 'YOUR_API_KEY_HERE';

        const app = document.getElementById('app');
        let currentImage = null;
        let currentStream = null;
        let currentResult = null;

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'ripely-v1';
                    self.addEventListener('install', (event) => {
                        event.waitUntil(caches.open(CACHE_NAME).then((cache) => cache.addAll(['/'])));
                    });
                    self.addEventListener('fetch', (event) => {
                        event.respondWith(caches.match(event.request).then((response) => response || fetch(event.request)));
                    });
                `;
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                navigator.serviceWorker.register(swUrl).catch(() => {});
            });
        }

        // SVG Icons
        const icons = {
            camera: '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>',
            upload: '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>',
            sparkles: '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg>',
            x: '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',
            alert: '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
            check: '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>',
            info: '<svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'
        };

        function render() {
            app.innerHTML = `
                <div class="min-h-screen">
                    <!-- Header -->
                    <div class="gradient-bg text-white px-6 py-6 shadow-lg">
                        <div class="max-w-4xl mx-auto">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="text-4xl">üçé</div>
                                    <div>
                                        <h1 class="text-2xl font-bold tracking-tight">SweetSpot</h1>
                                        <p class="text-sm opacity-90">AI Fruit Analysis</p>
                                    </div>
                                </div>
                                ${currentResult ? '' : '<div class="text-xs opacity-75 text-right">Powered by AI</div>'}
                            </div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="max-w-4xl mx-auto px-4 py-6">
                        <div id="content" class="fade-in"></div>
                    </div>
                </div>
            `;

            renderContent();
        }

        function renderContent() {
            const content = document.getElementById('content');
            
            if (!currentImage && !currentStream) {
                content.innerHTML = `
                    <div class="space-y-6 slide-up">
                        <!-- Hero Section -->
                        <div class="bg-white rounded-3xl p-8 shadow-lg">
                            <div class="text-center mb-8">
                                <div class="text-6xl mb-4">üçáüçäü•≠</div>
                                <h2 class="text-3xl font-bold text-gray-900 mb-3">Check Fruit Ripeness</h2>
                                <p class="text-lg text-gray-600">Instantly analyze ripeness and sweetness with AI</p>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="space-y-4">
                                <button onclick="startCamera()" class="w-full flex items-center justify-center gap-4 bg-gradient-to-r from-emerald-600 to-green-600 text-white py-5 px-6 rounded-2xl hover:from-emerald-700 hover:to-green-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 pulse-button">
                                    ${icons.camera}
                                    <span class="text-lg font-semibold">Take Photo</span>
                                </button>
                                
                                <button onclick="document.getElementById('fileInput').click()" class="w-full flex items-center justify-center gap-4 bg-white text-gray-700 py-5 px-6 rounded-2xl hover:bg-gray-50 transition-all border-2 border-gray-200 hover:border-emerald-500 shadow-md">
                                    ${icons.upload}
                                    <span class="text-lg font-semibold">Upload Image</span>
                                </button>
                            </div>
                            
                            <input type="file" id="fileInput" accept="image/*" onchange="handleFileUpload(event)" class="hidden" />
                        </div>

                        <!-- Feature Cards -->
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="bg-white rounded-2xl p-6 shadow-md text-center">
                                <div class="text-4xl mb-3">‚ö°</div>
                                <h3 class="font-bold text-gray-900 mb-2">Instant Results</h3>
                                <p class="text-sm text-gray-600">Get analysis in seconds</p>
                            </div>
                            
                            <div class="bg-white rounded-2xl p-6 shadow-md text-center">
                                <div class="text-4xl mb-3">üéØ</div>
                                <h3 class="font-bold text-gray-900 mb-2">Accurate</h3>
                                <p class="text-sm text-gray-600">AI-powered detection</p>
                            </div>
                            
                            <div class="bg-white rounded-2xl p-6 shadow-md text-center">
                                <div class="text-4xl mb-3">üíØ</div>
                                <h3 class="font-bold text-gray-900 mb-2">Free Forever</h3>
                                <p class="text-sm text-gray-600">No cost, no limits</p>
                            </div>
                        </div>

                        <!-- How It Works -->
                        <div class="bg-gradient-to-br from-emerald-50 to-green-50 rounded-2xl p-6 border border-emerald-200">
                            <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                                ${icons.info}
                                <span>How it works</span>
                            </h3>
                            <div class="space-y-3 text-sm text-gray-700">
                                <div class="flex items-start gap-3">
                                    <div class="w-6 h-6 rounded-full bg-emerald-600 text-white flex items-center justify-center flex-shrink-0 text-xs font-bold">1</div>
                                    <p>Take a clear photo of your fruit in good lighting</p>
                                </div>
                                <div class="flex items-start gap-3">
                                    <div class="w-6 h-6 rounded-full bg-emerald-600 text-white flex items-center justify-center flex-shrink-0 text-xs font-bold">2</div>
                                    <p>Our AI analyzes color, texture, and ripeness indicators</p>
                                </div>
                                <div class="flex items-start gap-3">
                                    <div class="w-6 h-6 rounded-full bg-emerald-600 text-white flex items-center justify-center flex-shrink-0 text-xs font-bold">3</div>
                                    <p>Get instant feedback on ripeness and sweetness level</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentStream) {
                content.innerHTML = `
                    <div class="space-y-4 slide-up">
                        <div class="bg-white rounded-3xl p-6 shadow-xl">
                            <div class="relative">
                                <video id="video" autoplay playsinline class="w-full rounded-2xl shadow-lg"></video>
                                <div class="absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold flex items-center gap-2">
                                    <div class="w-2 h-2 bg-white rounded-full animate-pulse"></div>
                                    LIVE
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <button onclick="capturePhoto()" class="flex-1 bg-gradient-to-r from-emerald-600 to-green-600 text-white py-4 px-6 rounded-2xl hover:from-emerald-700 hover:to-green-700 transition-all shadow-lg font-semibold text-lg">
                                üì∏ Capture
                            </button>
                            <button onclick="stopCamera()" class="bg-gray-200 text-gray-700 py-4 px-6 rounded-2xl hover:bg-gray-300 transition-all font-semibold">
                                Cancel
                            </button>
                        </div>
                    </div>
                `;
                setTimeout(() => {
                    const video = document.getElementById('video');
                    if (video) video.srcObject = currentStream;
                }, 0);
            } else if (currentImage && !currentResult) {
                content.innerHTML = `
                    <div class="space-y-4 slide-up">
                        <div class="bg-white rounded-3xl p-6 shadow-xl">
                            <img src="${currentImage}" alt="Captured" class="w-full rounded-2xl shadow-lg" />
                        </div>
                        
                        <div class="flex gap-3">
                            <button onclick="analyzeImage()" id="analyzeBtn" class="flex-1 bg-gradient-to-r from-emerald-600 to-green-600 text-white py-4 px-6 rounded-2xl hover:from-emerald-700 hover:to-green-700 transition-all shadow-lg font-semibold text-lg flex items-center justify-center gap-2">
                                ${icons.sparkles}
                                <span>Analyze Fruit</span>
                            </button>
                            <button onclick="reset()" class="bg-gray-200 text-gray-700 py-4 px-6 rounded-2xl hover:bg-gray-300 transition-all font-semibold flex items-center gap-2">
                                ${icons.x}
                                <span>Reset</span>
                            </button>
                        </div>
                        <div id="errorMsg"></div>
                    </div>
                `;
            } else if (currentResult) {
                const ripenessColor = {
                    'Underripe': 'bg-yellow-100 text-yellow-800 border-yellow-300',
                    'Perfect': 'bg-emerald-100 text-emerald-800 border-emerald-300',
                    'Overripe': 'bg-orange-100 text-orange-800 border-orange-300'
                }[currentResult.ripeness] || 'bg-gray-100 text-gray-800 border-gray-300';

                content.innerHTML = `
                    <div class="space-y-4 slide-up">
                        <div class="bg-white rounded-3xl p-6 shadow-xl">
                            <img src="${currentImage}" alt="Analyzed" class="w-full rounded-2xl shadow-lg mb-6" />
                            
                            <!-- Result Header -->
                            <div class="text-center mb-6">
                                <div class="inline-flex items-center gap-2 px-4 py-2 bg-emerald-100 text-emerald-800 rounded-full text-sm font-semibold mb-3">
                                    ${icons.check}
                                    <span>Analysis Complete</span>
                                </div>
                                <h2 class="text-3xl font-bold text-gray-900 mb-2">${currentResult.fruit}</h2>
                                <p class="text-gray-600">Confidence: ${currentResult.confidence}</p>
                            </div>

                            <!-- Main Stats -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-gradient-to-br from-emerald-50 to-green-50 rounded-2xl p-6 border-2 ${ripenessColor}">
                                    <p class="text-sm font-medium opacity-75 mb-2">Ripeness Level</p>
                                    <p class="text-2xl font-bold">${currentResult.ripeness}</p>
                                </div>
                                <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-6 border-2 border-amber-300">
                                    <p class="text-sm font-medium text-amber-900 opacity-75 mb-2">Sweetness</p>
                                    <p class="text-2xl font-bold text-amber-900">${currentResult.sweetness}</p>
                                </div>
                            </div>

                            <!-- Details -->
                            <div class="bg-gray-50 rounded-2xl p-6 mb-6">
                                <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
                                    ${icons.info}
                                    <span>Analysis Details</span>
                                </h3>
                                <ul class="space-y-3">
                                    ${currentResult.details.map(detail => `
                                        <li class="flex items-start gap-3 text-sm text-gray-700">
                                            <div class="w-1.5 h-1.5 rounded-full bg-emerald-600 mt-2 flex-shrink-0"></div>
                                            <span>${detail}</span>
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>

                            <!-- Recommendation -->
                            <div class="bg-gradient-to-r from-emerald-600 to-green-600 text-white rounded-2xl p-6 mb-6">
                                <h3 class="font-bold mb-3 text-lg flex items-center gap-2">
                                    üí° Recommendation
                                </h3>
                                <p class="leading-relaxed">${currentResult.recommendation}</p>
                            </div>

                            <button onclick="reset()" class="w-full bg-gray-100 text-gray-700 py-4 px-6 rounded-2xl hover:bg-gray-200 transition-all font-semibold text-lg">
                                Analyze Another Fruit
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        async function startCamera() {
            try {
                currentStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                render();
            } catch (err) {
                alert('Camera access denied. Please use the upload option instead.');
            }
        }

        function capturePhoto() {
            const video = document.getElementById('video');
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            currentImage = canvas.toDataURL('image/jpeg');
            stopCamera();
            render();
        }

        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    currentImage = e.target.result;
                    render();
                };
                reader.readAsDataURL(file);
            }
        }

        async function analyzeImage() {
            const btn = document.getElementById('analyzeBtn');
            const errorDiv = document.getElementById('errorMsg');
            
            if (!currentImage) return;
            
            btn.disabled = true;
            btn.innerHTML = `
                <div class="flex items-center justify-center gap-3">
                    <div class="w-5 h-5 border-3 border-white border-t-transparent rounded-full animate-spin"></div>
                    <span>Analyzing...</span>
                </div>
            `;
            btn.classList.add('opacity-75', 'cursor-not-allowed');
            
            try {
                if (GEMINI_API_KEY === 'YOUR_API_KEY_HERE') {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    currentResult = {
                        fruit: 'Papaya',
                        ripeness: 'Perfect',
                        sweetness: 'Very Sweet',
                        confidence: '85%',
                        details: [
                            'Golden yellow color indicates optimal ripeness',
                            'Slight softness suggests ready to eat',
                            'No visible bruising or spots detected',
                            'Should be consumed within 2-3 days for best quality'
                        ],
                        recommendation: 'This papaya is at peak ripeness! Perfect time to enjoy it. The sweetness level is excellent, making it ideal for fresh consumption or smoothies.'
                    };
                } else {
                    const base64Image = currentImage.split(',')[1];
                    
                    const response = await fetch(
                        `https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`,
                        {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [
                                        { 
                                            text: `Analyze this fruit or vegetable image carefully. Provide analysis in this exact JSON format:
                                            {
                                              "fruit": "name of fruit/vegetable",
                                              "ripeness": "Underripe/Perfect/Overripe",
                                              "sweetness": "Not Sweet/Mild/Sweet/Very Sweet",
                                              "confidence": "percentage",
                                              "details": ["observation 1", "observation 2", "observation 3", "observation 4"],
                                              "recommendation": "when to eat and how to use it"
                                            }
                                            Base your assessment on visible color, texture, spots, and typical ripeness indicators for that specific fruit/vegetable.`
                                        },
                                        { 
                                            inline_data: { 
                                                mime_type: "image/jpeg", 
                                                data: base64Image 
                                            }
                                        }
                                    ]
                                }]
                            })
                        }
                    );
                    
                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error.message);
                    }
                    
                    const text = data.candidates[0].content.parts[0].text;
                    const jsonMatch = text.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        currentResult = JSON.parse(jsonMatch[0]);
                    } else {
                        throw new Error('Could not parse AI response');
                    }
                }
                
                render();
                
            } catch (err) {
                console.error(err);
                errorDiv.innerHTML = `
                    <div class="bg-red-50 border-2 border-red-200 rounded-2xl p-4 flex items-start gap-3">
                        ${icons.alert}
                        <div class="text-sm text-red-800">
                            <p class="font-semibold mb-1">Analysis Failed</p>
                            <p>${err.message}</p>
                        </div>
                    </div>
                `;
                btn.disabled = false;
                btn.innerHTML = `${icons.sparkles} <span>Analyze Fruit</span>`;
                btn.classList.remove('opacity-75', 'cursor-not-allowed');
            }
        }

        function reset() {
            currentImage = null;
            currentResult = null;
            stopCamera();
            render();
        }

        // Initial render
        render();
    </script>
</body>
</html>
